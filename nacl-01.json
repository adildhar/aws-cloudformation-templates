{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "tradetracker-nacl (NACL rules)",
  
  "Mappings" : {
    "RegionMap" : {
      "ap-southeast-1" : {
        "privatesubnetnacl"  : "acl-6c912908",
        "privatesubnetcidr1" : "10.110.11.0/26",
        "privatesubnetcidr2" : "10.110.11.64/26",
        "publicsubnetnacl" : "acl-63912907",
        "publicsubnetcidr1" : "10.110.11.0/26",
        "publicsubnetcidr2" : "10.110.11.64/26"
      },
      "us-west-2" : {
        "vpccidr" : ""
      },
      "eu-west-1" : {
        "vpccidr" : ""
      },
      "ap-northeast-1" : {
        "vpccidr" : ""
      }
    }
  },

  "Resources" : {
    "PrivSvrNACLEntryOut51": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": "0.0.0.0/0",
        "Egress": true,
        "Protocol": "1",
        "RuleAction": "allow",
        "RuleNumber": "51",
        "Icmp": {"Code": "-1", "Type": "3"},
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "privatesubnetnacl" ] }
      }
    },
    "PrivSvrNACLEntryOut200": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": "0.0.0.0/0",
        "Egress": true,
        "Protocol": "6",
        "RuleAction": "allow",
        "RuleNumber": "200",
        "PortRange": {"From": "80", "To": "80"},
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "privatesubnetnacl" ] }
      }
    },
    "PrivSvrNACLEntryOut300": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": "0.0.0.0/0",
        "Egress": true,
        "Protocol": "6",
        "RuleAction": "allow",
        "RuleNumber": "300",
        "PortRange": {"From": "443", "To": "443"},
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "privatesubnetnacl" ] }
      }
    },
    "PrivSvrNACLEntryOut325": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "privatesubnetcidr1" ] },
        "Egress": true,
        "Protocol": "-1",
        "RuleAction": "allow",
        "RuleNumber": "325",
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "privatesubnetnacl" ] }
      }
    },
    "PrivSvrNACLEntryOut330": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "privatesubnetcidr2" ] },
        "Egress": true,
        "Protocol": "-1",
        "RuleAction": "allow",
        "RuleNumber": "330",
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "privatesubnetnacl" ] }
      }
    },
    "PrivSvrNACLEntryOut400": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": "0.0.0.0/0",
        "Egress": true,
        "Protocol": "6",
        "RuleAction": "allow",
        "RuleNumber": "400",
        "PortRange": {"From": "1024", "To": "65535"},
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "privatesubnetnacl" ] }
      }
    },
    "PrivSvrNACLEntryIn51": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": "0.0.0.0/0",
        "Egress": false,
        "Protocol": "1",
        "RuleAction": "allow",
        "RuleNumber": "51",
        "Icmp": {"Code": "-1", "Type": "3"},
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "privatesubnetnacl" ] }
      }
    },
    "PrivSvrNACLEntryIn60": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": "0.0.0.0/0",
        "Protocol": "6",
        "RuleAction": "allow",
        "RuleNumber": "60",
        "PortRange": {"From": "1024", "To": "65535"},
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "privatesubnetnacl" ] }
      }
    },
    "PrivSvrNACLEntryIn100": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": "0.0.0.0/0",
        "Protocol": "6",
        "RuleAction": "allow",
        "RuleNumber": "100",
        "PortRange": {"From": "80", "To": "80"},
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "privatesubnetnacl" ] }
      }
    },
    "PrivSvrNACLEntryIn200": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": "0.0.0.0/0",
        "Protocol": "6",
        "RuleAction": "allow",
        "RuleNumber": "200",
        "PortRange": {"From": "443", "To": "443"},
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "privatesubnetnacl" ] }
      }
    },
    "PrivSvrNACLEntryIn225": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "privatesubnetcidr1" ] },
        "Protocol": "-1",
        "RuleAction": "allow",
        "RuleNumber": "225",
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "privatesubnetnacl" ] }
      }
    },
    "PrivSvrNACLEntryIn230": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "privatesubnetcidr2" ] },
        "Protocol": "-1",
        "RuleAction": "allow",
        "RuleNumber": "230",
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "privatesubnetnacl" ] }
      }
    },
    "PubSvrNACLEntryOut50": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": "0.0.0.0/0",
        "Egress": true,
        "Protocol": "1",
        "RuleAction": "allow",
        "RuleNumber": "50",
        "Icmp": {"Code": "-1", "Type": "0"},
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "publicsubnetnacl" ] }
      }
    },
    "PubSvrNACLEntryOut51": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": "0.0.0.0/0",
        "Egress": true,
        "Protocol": "1",
        "RuleAction": "allow",
        "RuleNumber": "51",
        "Icmp": {"Code": "-1", "Type": "3"},
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "publicsubnetnacl" ] }
      }
    },
    "PubSvrNACLEntryOut100": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": "0.0.0.0/0",
        "Egress": true,
        "Protocol": "6",
        "RuleAction": "allow",
        "RuleNumber": "100",
        "PortRange": {"From": "1024", "To": "65535"},
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "publicsubnetnacl" ] }
      }
    },
    "PubSvrNACLEntryOut200": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": "0.0.0.0/0",
        "Egress": true,
        "Protocol": "6",
        "RuleAction": "allow",
        "RuleNumber": "200",
        "PortRange": {"From": "80", "To": "80"},
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "publicsubnetnacl" ] }
      }
    },
    "PubSvrNACLEntryOut300": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": "0.0.0.0/0",
        "Egress": true,
        "Protocol": "6",
        "RuleAction": "allow",
        "RuleNumber": "300",
        "PortRange": {"From": "443", "To": "443"},
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "publicsubnetnacl" ] }
      }
    },
    "PubSvrNACLEntryOut400": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" },  "publicsubnetcidr1" ] },
        "Egress": true,
        "Protocol": "-1",
        "RuleAction": "allow",
        "RuleNumber": "400",
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "publicsubnetnacl" ] }
      }
    },
    "PubSvrNACLEntryOut410": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" },  "publicsubnetcidr2" ] },
        "Egress": true,
        "Protocol": "-1",
        "RuleAction": "allow",
        "RuleNumber": "410",
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "publicsubnetnacl" ] }
      }
    },
    "PubSvrNACLEntryIn50": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": "0.0.0.0/0",
        "Protocol": "1",
        "RuleAction": "allow",
        "RuleNumber": "50",
        "Icmp": {"Code": "-1", "Type": "8"},
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "publicsubnetnacl" ] }
      }
    },
    "PubSvrNACLEntryIn60": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": "0.0.0.0/0",
        "Protocol": "6",
        "RuleAction": "allow",
        "RuleNumber": "60",
        "PortRange": {"From": "1024", "To": "65535"},
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "publicsubnetnacl" ] }
      }
    },
    "PubSvrNACLEntryIn100": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": "0.0.0.0/0",
        "Protocol": "6",
        "RuleAction": "allow",
        "RuleNumber": "100",
        "PortRange": {"From": "80", "To": "80"},
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "publicsubnetnacl" ] }
      }
    },
    "PubSvrNACLEntryIn200": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": "0.0.0.0/0",
        "Protocol": "6",
        "RuleAction": "allow",
        "RuleNumber": "200",
        "PortRange": {"From": "443", "To": "443"},
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "publicsubnetnacl" ] }
      }
    },
    "PubSvrNACLEntryIn225": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" },  "publicsubnetcidr1" ] },
        "Protocol": "-1",
        "RuleAction": "allow",
        "RuleNumber": "225",
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "publicsubnetnacl" ] }
      }
    },
    "PubSvrNACLEntryIn230": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "CidrBlock": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" },  "publicsubnetcidr2" ] },
        "Protocol": "-1",
        "RuleAction": "allow",
        "RuleNumber": "230",
        "NetworkAclId": { "Fn::FindInMap" : [ "RegionMap", { "Ref" : "AWS::Region" }, "publicsubnetnacl" ] }
      }
    }
  }
}

